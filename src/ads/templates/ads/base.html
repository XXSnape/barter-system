<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">Создать новое объявление</h2>

    <form id="ad-create-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Общие ошибки формы -->
        {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        <div class="mb-3">
            <label for="title" class="form-label">Название*</label>
            <input type="text" class="form-control" id="title" name="title"
                   required maxlength="128"
                   placeholder="Например: Книга 'Мастер и Маргарита'">
            {% if form.errors.title %}
            <div class="text-danger">{{ form.errors.title }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Описание*</label>
            <textarea class="form-control" id="description" name="description"
                      rows="5" required
                      placeholder="Подробно опишите товар..."></textarea>
            {% if form.errors.description %}
            <div class="text-danger">{{ form.errors.description }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="image_url" class="form-label">Ссылка на изображение</label>
            <input type="url" class="form-control" id="image_url" name="image_url"
                   maxlength="512"
                   placeholder="https://example.com/image.jpg">
            {% if form.errors.image_url %}
            <div class="text-danger">{{ form.errors.image_url }}</div>
            {% endif %}
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="category" class="form-label">Категория*</label>
                <select class="form-select" id="category" name="category" required>
                    <option value="" selected disabled>Выберите категорию</option>
                    <option value="Книги">Книги</option>
                    <option value="Электроника">Электроника</option>
                    <option value="Одежда">Одежда</option>
                    <!-- Добавьте другие категории -->
                </select>
                {% if form.errors.category %}
                <div class="text-danger">{{ form.errors.category }}</div>
                {% endif %}
            </div>

            <div class="col-md-6">
                <label for="condition" class="form-label">Состояние*</label>
                <select class="form-select" id="condition" name="condition" required>
                    <option value="" selected disabled>Выберите состояние</option>
                    <option value="Новое">Новое</option>
                    <option value="Б/у">Б/у</option>
                    <option value="На запчасти">На запчасти</option>
                </select>
                {% if form.errors.condition %}
                <div class="text-danger">{{ form.errors.condition }}</div>
                {% endif %}
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Создать объявление</button>
    </form>
</div>
<script>
document.getElementById('ad-create-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);

    try {
        const response = await fetch('/api/v1/ads/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(Object.fromEntries(formData))
        });

        if (response.ok) {
            window.location.href = '/ads/';  // Редирект после успешного создания
        } else {
            const errors = await response.json();
            console.error('Ошибка создания:', errors);
        }
    } catch (error) {
        console.error('Ошибка сети:', error);
    }
});
</script>
</body>
</html>